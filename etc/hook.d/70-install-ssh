#!/bin/sh
#
#  This script installs OpenSSH upon the new system.  It must make sure
# that the server is not running before it exits - otherwise the temporary
# mounted directory will not be unmountable.
#
# Steve
# --
# http://www.steve.org.uk/


prefix=$1
dist=$2



#
#  Sets up the installation of OpenSSH on a Debian GNU/Linux system.
#
function setupDebian
{
    DEBIAN_FRONTEND=noninteractive chroot ${prefix} /usr/bin/apt-get --yes --force-yes install ssh

    #
    #  Make sure sshd isn't running, this will cause our unmounting of the
    # disk image to fail..
    #
    chroot ${prefix} /etc/init.d/ssh stop
}



#
#  Sets up the installation of OpenSSH on a CentOS4 installation.
#
function setupCentOS4
{
    chroot ${prefix}/usr/bin/yum -y install openssh-server
    chroot ${prefix}/usr/bin/yum -y install openssh-server
}



#
#  Entry point to the script.
#
case "${dist}" in
    sarge|etch|sid)
        setupDebianSources
        ;;
    centos4)
	setupCentOS4
	;;
    *)
	echo "Unknown distribution '${dist}'.  Fixme";
	exit;
	;;
esac



